stateDiagram-v2
    direction LR
    
    [*] --> Idle
    
    state Idle {
        description The client is not connected to a server. This is the initial and final state of a session.
    }
    
    state Connected {
        description A TCP connection to the server is established and the client is ready to send a request.
    }
    
    state Waiting_For_Response {
        description The client has sent a MODBUS request and is waiting for a response from the server.
    }

    Idle --> Connected : Establish_Connection
    note right of Idle : Client initiates a TCP connection to the server's port 502.<br/>(Ref: Sec 4.2.1, 4.3.1 connect())
    
    Connected --> Waiting_For_Response : Send_Modbus_Request
    note right of Connected : Client sends a MODBUS request ADU over the established connection.<br/>(Ref: Sec 4.4.1.2)
    
    Waiting_For_Response --> Connected : Receive_Modbus_Response
    note left of Waiting_For_Response : A valid MODBUS response (or exception) is received.<br/>The transaction is complete and the client is ready for another.<br/>(Ref: Sec 4.4.1.3)
    
    Waiting_For_Response --> Connected : Response_Timeout
    note left of Waiting_For_Response : The client's response timer for the request expires.<br/>The client aborts the transaction but the connection remains open.<br/>(Ref: Sec 4.4.1.4)
    
    Connected --> Idle : Close_Connection
    note right of Connected : The client application initiates a graceful disconnection.<br/>(Ref: Sec 4.2.1.2)

    Connected --> Idle : Connection_Lost
    note right of Connected : The connection is terminated unexpectedly (e.g., TCP Keep-Alive failure).<br/>(Ref: Sec 4.2.2)

    Waiting_For_Response --> Idle : Connection_Lost
    note left of Waiting_For_Response : The connection is terminated unexpectedly while waiting for a response.<br/>(Ref: Sec 4.2.2)

    Idle --> [*]
```